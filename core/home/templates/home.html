<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <title>Hello, world!</title>
  </head>
  <body>
    <div class="progress container mt-5 ">
        <div class="progress-bar bg-success" id="progressBar" role="progressbar" style="width: 0" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
      </div>

    <table class="table container mt-5 pt-5">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Name</th>
            <th scope="col">Age</th>
            <th scope="col">Email</th>
          </tr>
        </thead>
        <tbody id="table_data">

        </tbody>
      </table>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <script>
      var url = "ws://localhost:8000/ws/new/";
      var socket = new WebSocket(url);
      socket.onopen = function(e){
        console.log("socket connected...")

      }
      socket.onmessage = function(e){
        var data = JSON.parse(e.data);
        console.log(data);
        if (data.payload){
          addData(data.payload)
          progressBarUpdate(data.payload.total,data.payload.current_total)
        }
      }
      socket.onclose = function(e){
        console.log("socket disconnected...")

      }

      function addData(data){
        var html = `<tr><th scope="row">${data.current_total}</th><td colspan="1">${data.name}</td><td>${data.age}</td><td>${data.email}</td></tr>`
        document.getElementById('table_data').innerHTML += html;
      }

      function progressBarUpdate(total,current_total){
        var p_bar =  document.getElementById('progressBar');
        var percent = (current_total / total)*100;
        p_bar.style.width = percent + '%'
      }
    </script>


  </body>
</html>